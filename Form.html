<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agregar Producto</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    :root {
      --primary-color: #2c3e50;
      --secondary-color: #ecf0f1;
      --accent-color: black;
      --danger-color: black;
      --success-color: #2ecc71;
      --border-radius: 8px;
      --box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      --transition: all 0.3s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: #f5f5f5;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      padding: 20px;
    }

    .formulario {
      background: #fff;
      padding: 30px;
      margin: 0 auto;
      width: 100%;
      max-width: 800px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
    }

    .modulo {
      background: #fff;
      padding: 20px;
      margin-bottom: 25px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      border-left: 4px solid var(--accent-color);
    }

    .modulo h3 {
      margin-bottom: 15px;
      font-size: 1.2rem;
      color: var(--primary-color);
    }

    .formulario h2 {
      font-size: 1.8rem;
      margin-bottom: 25px;
      color: var(--primary-color);
      text-align: center;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--secondary-color);
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #555;
    }

    input, textarea, select {
      width: 100%;
      padding: 10px 12px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: var(--border-radius);
      font-size: 1rem;
      transition: var(--transition);
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }

    .fila {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    .campo {
      flex: 1;
      min-width: 200px;
    }

    .boton {
      background: var(--primary-color);
      color: white;
      padding: 12px 20px;
      font-size: 1rem;
      font-weight: 600;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
      width: 100%;
    }

    .boton:hover {
      background: #1a252f;
      transform: translateY(-2px);
    }

    .boton-secundario {
      background-color: var(--secondary-color);
      color: var(--primary-color);
      border: none;
      padding: 10px 15px;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: var(--transition);
      font-weight: 600;
      white-space: nowrap;
    }

    .boton-secundario:hover {
      background-color: #bdc3c7;
    }

    .boton-peligro {
      background-color: var(--danger-color);
      color: white;
    }

    .boton-peligro:hover {
      background-color: #c0392b;
    }

    .contenedor-imagen {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 15px;
    }

    #previewImagen {
      margin-top: 10px;
      text-align: center;
    }

    #previewImagen img {
      max-width: 100%;
      max-height: 300px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      border: 1px solid #ddd;
    }

    .acciones {
      display: flex;
      gap: 15px;
      margin-top: 30px;
    }

    .acciones button {
      flex: 1;
    }

    .mensaje-error {
      color: var(--danger-color);
      font-size: 0.9rem;
      margin-top: -10px;
      margin-bottom: 15px;
      display: none;
    }

    .campo-invalido {
      border-color: var(--danger-color) !important;
    }

    /* Animaciones */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .modulo {
      animation: fadeIn 0.5s ease-out forwards;
    }

    .modulo:nth-child(2) { animation-delay: 0.1s; }
    .modulo:nth-child(3) { animation-delay: 0.2s; }
    .modulo:nth-child(4) { animation-delay: 0.3s; }

    /* Responsive */
    @media (max-width: 768px) {
      .fila {
        flex-direction: column;
        gap: 0;
      }
      
      .campo {
        width: 100%;
      }
      
      .acciones {
        flex-direction: column;
      }
      
      .formulario {
        padding: 20px;
      }
    }

    /* Mejoras de accesibilidad */
    [aria-invalid="true"] {
      border-color: var(--danger-color);
    }
    
    [aria-invalid="true"] + .mensaje-error {
      display: block;
    }
  </style>
</head>
<body>

  <form id="formProducto" class="formulario" novalidate>
    <h2>Añadir producto</h2>

    <!-- Módulo: Información básica -->
    <div class="modulo">
      <h3>Información básica</h3>

      <label for="titulo">Título</label>
      <input type="text" id="titulo" name="titulo" required aria-required="true">
      <div class="mensaje-error" id="error-titulo">Este campo es obligatorio</div>

      <label for="descripcion">Descripción</label>
      <textarea id="descripcion" name="descripcion" rows="4" required aria-required="true"></textarea>
      <div class="mensaje-error" id="error-descripcion">Este campo es obligatorio</div>
    </div>

    <!-- Módulo: Elementos multimedia -->
    <div class="modulo">
      <h3>Elementos multimedia</h3>
      <div class="contenedor-imagen">
        <input type="file" id="multimedia" name="multimedia" accept="image/*" required aria-required="true">
        <button type="button" id="eliminarImagen" class="boton-secundario boton-peligro">Eliminar imagen</button>
      </div>
      <div class="mensaje-error" id="error-multimedia">Debes seleccionar una imagen</div>
      <div id="previewImagen"></div>
    </div>

    <!-- Módulo: Categorías -->
    <div class="modulo">
      <h3>Categorías</h3>
      <div class="fila">
        <div class="campo">
          <label for="categoria">Elegir categoría</label>
          <select id="categoria" name="categoria" required aria-required="true">
            <option value="">Selecciona una categoría</option>
            <option value="Playeras">Playeras</option>
            <option value="Pantalones">Pantalones</option>
            <option value="Tenis">Tenis</option>
            <option value="Accesorios">Accesorios</option>
            <option value="Sudaderas">Sudaderas</option>
          </select>
          <div class="mensaje-error" id="error-categoria">Debes seleccionar una categoría</div>
        </div>
        <div class="campo">
          <label for="nuevaCategoria">Crear categoría</label>
          <input type="text" id="nuevaCategoria" name="nuevaCategoria" placeholder="(Opcional)">
          <button type="button" id="btnAgregarCategoria" class="boton-secundario">Agregar</button>
        </div>
      </div>

      <div class="fila">
        <div class="campo">
          <label for="eliminarCategoria">Eliminar categoría</label>
          <select id="eliminarCategoria" name="eliminarCategoria"></select>
          <button type="button" id="btnEliminarCategoria" class="boton-secundario boton-peligro">Eliminar</button>
        </div>
      </div>
    </div>

    <!-- Módulo: Precios y variantes -->
    <div class="modulo">
      <h3>Precios y variantes</h3>
      <div class="fila">
        <div class="campo">
          <label for="precio">Precio ($)</label>
          <input type="number" id="precio" name="precio" min="0.01" step="0.01" required aria-required="true">
          <div class="mensaje-error" id="error-precio">El precio debe ser mayor a 0</div>
        </div>
        <div class="campo">
          <label for="inventario">Inventario</label>
          <input type="number" id="inventario" name="inventario" min="0" required aria-required="true">
          <div class="mensaje-error" id="error-inventario">El inventario no puede ser negativo</div>
        </div>
      </div>

      <div class="fila">
        <div class="campo">
          <label for="descuento">Descuento (%)</label>
          <input type="number" id="descuento" name="descuento" min="0" max="100" value="0">
        </div>
        <div class="campo">
          <label for="precioConDescuento">Precio con descuento ($)</label>
          <input type="number" id="precioConDescuento" name="precioConDescuento" step="0.01" readonly>
        </div>
      </div>

      <div class="fila">
        <div class="campo">
          <label for="talla">Tallas (separadas por comas)</label>
          <input type="text" id="talla" name="talla" placeholder="Ej: S, M, L, XL" required aria-required="true">
          <div class="mensaje-error" id="error-talla">Este campo es obligatorio</div>
        </div>
        <div class="campo">
          <label for="color">Color</label>
          <input type="text" id="color" name="color" required aria-required="true">
          <div class="mensaje-error" id="error-color">Este campo es obligatorio</div>
        </div>
      </div>
    </div>

    <!-- Botones -->
    <div class="acciones">
      <button type="reset" class="boton-secundario">Cancelar</button>
      <button type="submit" class="boton">Guardar producto</button>
    </div>
  </form>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Elementos del DOM
      const form = document.getElementById('formProducto');
      const multimediaInput = document.getElementById('multimedia');
      const eliminarImagenBtn = document.getElementById('eliminarImagen');
      const previewImagen = document.getElementById('previewImagen');
      const categoriaSelect = document.getElementById('categoria');
      const nuevaCategoriaInput = document.getElementById('nuevaCategoria');
      const btnAgregarCategoria = document.getElementById('btnAgregarCategoria');
      const eliminarCategoriaSelect = document.getElementById('eliminarCategoria');
      const btnEliminarCategoria = document.getElementById('btnEliminarCategoria');
      const descuentoInput = document.getElementById('descuento');
      const precioInput = document.getElementById('precio');
      const precioConDescuentoInput = document.getElementById('precioConDescuento');
      
      // Variables para estado
      let categorias = ['Playeras', 'Pantalones', 'Tenis', 'Accesorios', 'Sudaderas'];

      // Inicialización
      actualizarEliminarCategoria();
      initValidaciones();

      // Event Listeners
      multimediaInput.addEventListener('change', handleImageUpload);
      eliminarImagenBtn.addEventListener('click', eliminarImagen);
      btnAgregarCategoria.addEventListener('click', agregarCategoria);
      btnEliminarCategoria.addEventListener('click', eliminarCategoria);
      precioInput.addEventListener('input', calcularPrecioConDescuento);
      descuentoInput.addEventListener('input', calcularPrecioConDescuento);
      form.addEventListener('submit', handleSubmit);

      // Funciones
      function handleImageUpload() {
        const file = multimediaInput.files[0];
        if (file) {
          if (!file.type.match('image.*')) {
            mostrarError(multimediaInput, 'Solo se permiten archivos de imagen');
            return;
          }
          
          if (file.size > 2 * 1024 * 1024) { // 2MB
            mostrarError(multimediaInput, 'La imagen no debe exceder los 2MB');
            return;
          }
          
          const reader = new FileReader();
          reader.onload = function(e) {
            previewImagen.innerHTML = `<img src="${e.target.result}" alt="Vista previa del producto">`;
            limpiarError(multimediaInput);
          };
          reader.readAsDataURL(file);
        }
      }

      function eliminarImagen() {
        multimediaInput.value = '';
        previewImagen.innerHTML = '';
        limpiarError(multimediaInput);
      }

      function agregarCategoria() {
        const nuevaCategoria = nuevaCategoriaInput.value.trim();
        
        if (!nuevaCategoria) {
          mostrarError(nuevaCategoriaInput, 'Ingresa un nombre para la categoría');
          return;
        }
        
        if (categorias.includes(nuevaCategoria)) {
          mostrarError(nuevaCategoriaInput, 'Esta categoría ya existe');
          return;
        }
        
        categorias.push(nuevaCategoria);
        actualizarSelectsCategorias();
        nuevaCategoriaInput.value = '';
        limpiarError(nuevaCategoriaInput);
        
        Swal.fire({
          title: '¡Éxito!',
          text: `Categoría "${nuevaCategoria}" añadida.`,
          icon: 'success',
          confirmButtonColor: '#2c3e50'
        });
      }

      function eliminarCategoria() {
        const categoriaAEliminar = eliminarCategoriaSelect.value;
        
        if (!categoriaAEliminar) {
          Swal.fire({
            title: 'Error',
            text: 'Selecciona una categoría para eliminar',
            icon: 'error',
            confirmButtonColor: '#e74c3c'
          });
          return;
        }
        
        categorias = categorias.filter(cat => cat !== categoriaAEliminar);
        actualizarSelectsCategorias();
        
        Swal.fire({
          title: '¡Éxito!',
          text: `Categoría "${categoriaAEliminar}" eliminada.`,
          icon: 'success',
          confirmButtonColor: '#2c3e50'
        });
      }

      function actualizarSelectsCategorias() {
        // Actualizar select de categorías
        categoriaSelect.innerHTML = '<option value="">Selecciona una categoría</option>';
        categorias.forEach(categoria => {
          const option = document.createElement('option');
          option.value = categoria;
          option.textContent = categoria;
          categoriaSelect.appendChild(option);
        });
        
        // Actualizar select para eliminar
        actualizarEliminarCategoria();
      }

      function actualizarEliminarCategoria() {
        eliminarCategoriaSelect.innerHTML = '';
        categorias.forEach(categoria => {
          const option = document.createElement('option');
          option.value = categoria;
          option.textContent = categoria;
          eliminarCategoriaSelect.appendChild(option);
        });
      }

      function calcularPrecioConDescuento() {
        const precio = parseFloat(precioInput.value) || 0;
        const descuento = parseFloat(descuentoInput.value) || 0;
        
        if (precio > 0 && descuento >= 0 && descuento <= 100) {
          const descuentoAplicado = precio * (descuento / 100);
          const precioFinal = precio - descuentoAplicado;
          precioConDescuentoInput.value = precioFinal.toFixed(2);
        } else {
          precioConDescuentoInput.value = '';
        }
      }

      function initValidaciones() {
        // Validación en tiempo real para campos requeridos
        const camposRequeridos = form.querySelectorAll('[required]');
        camposRequeridos.forEach(campo => {
          campo.addEventListener('blur', () => validarCampo(campo));
        });
        
        // Validación especial para precio
        precioInput.addEventListener('blur', () => {
          if (parseFloat(precioInput.value) <= 0) {
            mostrarError(precioInput, 'El precio debe ser mayor a 0');
          } else {
            limpiarError(precioInput);
          }
        });
        
        // Validación especial para inventario
        document.getElementById('inventario').addEventListener('blur', function() {
          if (parseInt(this.value) < 0) {
            mostrarError(this, 'El inventario no puede ser negativo');
          } else {
            limpiarError(this);
          }
        });
      }

      function validarCampo(campo) {
        if (!campo.value.trim()) {
          mostrarError(campo, 'Este campo es obligatorio');
          return false;
        }
        
        limpiarError(campo);
        return true;
      }

      function mostrarError(campo, mensaje) {
        campo.setAttribute('aria-invalid', 'true');
        const errorElement = document.getElementById(`error-${campo.name || campo.id}`);
        if (errorElement) {
          errorElement.textContent = mensaje;
        }
      }

      function limpiarError(campo) {
        campo.removeAttribute('aria-invalid');
        const errorElement = document.getElementById(`error-${campo.name || campo.id}`);
        if (errorElement) {
          errorElement.textContent = '';
        }
      }

      function validarFormulario() {
        let valido = true;
        
        const camposRequeridos = form.querySelectorAll('[required]');
        camposRequeridos.forEach(campo => {
          if (!validarCampo(campo)) valido = false;
        });
        
        if (parseFloat(precioInput.value) <= 0) {
          mostrarError(precioInput, 'El precio debe ser mayor a 0');
          valido = false;
        }
        
        if (parseInt(document.getElementById('inventario').value) < 0) {
          mostrarError(document.getElementById('inventario'), 'El inventario no puede ser negativo');
          valido = false;
        }
        
        return valido;
      }

      function handleSubmit(e) {
        e.preventDefault();
        
        if (!validarFormulario()) {
          Swal.fire({
            title: 'Error',
            text: 'Por favor corrige los errores en el formulario',
            icon: 'error',
            confirmButtonColor: '#e74c3c'
          });
          return;
        }
        
        Swal.fire({
          title: '¡Guardado!',
          text: 'Producto añadido exitosamente.',
          icon: 'success',
          confirmButtonColor: '#2c3e50'
        }).then(() => {
          
          form.reset();
          previewImagen.innerHTML = '';
        });
      }
    });
  </script>
</body>
</html>